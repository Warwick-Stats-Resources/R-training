{
  "hash": "c5224c8a5263f778efcc50e07348ccb3",
  "result": {
    "markdown": "---\ntitle: Open code, git and GitHub\nsubtitle: Advanced R Course\nauthor: Ella Kaye | Department of Statistics | University of Warwick\ntitle-slide-attributes:\n  data-background-color: \"#552D62\"\ndate: 2023-01-16\ndate-format: long\nformat: \n  revealjs:\n    theme: [default, ../../slides.scss]\n    slide-number: true\n    execute:\n      echo: true\n      code-overflow: wrap\n---\n\n\n## Overview\n\n- Open code and software\n\n- git\n\n- GitHub\n\n- git and GitHub with RStudio\n\n# Open code and software {background-color=\"#552D62\"}\n\nFrom <https://www.heatherturner.net/talks/gregynog2022/#1>\n\n## Open practices\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\nRecognised as integral to healthy research culture\n\nWorking openly means that our work is \n\n - Accessible, for free\n - Open to scrutiny (verifiable)\n - Reproducible\n:::\n\n::: {.column width=\"50%\"}\n<img src=\"../images/open-pexels-analogicus-5395777.jpg\" alt=\"A rustic wooden 'Open' sign on a green wooden door\" style=\"height:400px\">\n<small>(source: [analogicus from Pexels](https://www.pexels.com/photo/wooden-welcome-signage-on-green-wooden-door-5395777/))</small>\n:::\n\n::::\n\n## Code and Software\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\nScripts: e.g analysis/simulation\n\n- Customised\n- Reproducible workflow\n    - read data\n    - analyse\n    - summarise\n    - report\n:::\n\n::: {.column width=\"50%\"}\nSoftware: Package, tool, dashboard\n\n- Optimized\n- Reusable\n- Sharable\n:::\n\n::::\n\n## Why share code and software?\n\nBeyond general benefits of open practices\n\n- Increased impact and reputation\n- Faster translation into practice\n- Additional, citable, outputs\n\nBenefits of coding in the open\n\n- Encourages good practices\n- Facilitates collaboration\n- Can give access to software engineering tools\n\n## Sharing code in an online repository\n\n:::: {.columns}\n\n::: {.column width=\"66%\"}\n### Pros\n\n- Version control (commit history + releases)\n- README.md for quick documentation\n- Facilitates contribution (bug reports, patches)\n- Can use CITATION.cff file for clear citation [GitHub]\n- Links to Zenodo for publishing releases\n\n### Cons\n\n- Learning curve to take full advantage\n:::\n\n::: {.column width=\"33%\"}\n<br>\n<center>\n<a href = https://github.com/>\n<img src=\"../images/GitHub_Logo.png\" alt=\"Logo for GitHub\" style=\"height:90px\">\n</a>\n<br>\n<a href = https://github.com/>\n<img src=\"../images/gitlab-logo.png\" alt=\"Logo for GitLab\" style=\"height:180px\"> <br>\n</a>\n</center>\n:::\n\n::::\n\n## More on open code and software\n\nSee <https://www.heatherturner.net/talks/gregynog2022/#1>\n\n\n# git {background-color=\"#552D62\"}\n\n## Version Control\n\nWhen developing code, we often want to keep old versions.\n\nWe might save with different files names\n```\ncode                               \n  ¦--simulations.R                  \n  ¦--simulations_correct_sd.R       \n  ¦--simulations_return_parameters.R\n```  \nor comment on changes (especially when collaborating with others)\n\n::: {.cell}\n\n```{.r .cell-code}\n## EK 2023-01-10 use geom_bar instead of geom_histogram\n## p <- p + geom_histogram(stat = \"identity\")\np <- p + geom_bar(stat = \"identity\")\n## HT 2023-01-09 remove legend from plot\np <- p + theme(legend.position = \"none\")\n```\n:::\n\nEither way it can get messy and hard to track/revert changes!\n\n\n## git\n\ngit is a version control system that allows us to record changes made to files in a _repository_ or _repo_.\n\nEach version has a unique ID and metadata:\n\n - Who created the new version\n - A short description of changes made\n - When the version was made\n \nVersions can be compared, restored and merged.\n\n# {#git-protection data-menu-title=\"Hadley Wickham and Jenny Bryan quote\" background-image=\"../images/github_wickham_bryan_git_quote.png\" background-size=\"contain\"}\n\n## git repository\n\nTo get started, a repository must be created locally (within a working directory on your computer) or on a remote hosting platform (we'll use GitHub).\n\ngit can then track when files/folders are \n\n   - Added\n   - Modified\n   - Deleted\n   \nRepositories can have multiple _branches_ of development. We will work on a single branch, with the default name of `main`.  \n\n## Staging and committing\n\nVersions are created in a _commit_.\n\nWe prepare the commit by _staging_ changes we want to record:\n\n * _Untracked_ files (git treats the whole content as new)\n * _Tracked_ files that have been modified or deleted since the last commit\n \nThink of it like taking photographs: we stage the scene by adding/removing people, or changing people's outfits, when we have a scene we want to save we take a photograph.\n\n# GitHub {background-color=\"#552D62\"}\n\n## git + Github\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\nThe full power comes by connecting a local repo to GitHub. \n\n - You can make changes locally and _push_ them to GitHub\n - You can make changes via the GitHub website and later _pull_ them into your local copy.\n - Collaborators can also push/pull changes to the repo.\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../images/how_github_works.png){fig-align='center' fig-alt='Diagram showing arrows to and from your repo and a central remote repo (GitHub). There are more arrows to and from GitHub and the web UI. There are also arrows to and from GitHub and \"their repo\" representing another person.' width=100%}\n:::\n:::\n\n:::\n\n::::\n\n## GitHub\n\nWarwick GitHub Enterprise: <https://github.warwick.ac.uk/>\n\n - Use for Warwick-specific, private projects\n - Username will be ITS username\n\nGitHub: <https://github.com/>\n\n - Free version allows private/public projects\n - Can share/collaborate with people outside Warwick\n - Develop your personal portfolio\n\n## Features\n\nGitHub repositories have some nice features:\n\n- `README.md` displayed as HTML\n- Browsable commit history\n- _Issues_ where you/others can note bug reports/TODO/feature requests\n- _Pull requests_ (advanced) where you/others can propose changes to the code to be reviewed\n- _Actions_ (advanced) automated actions when you commit to the repo\n- _Projects_ (advanced) to organize issues (To Do/In Progress/Done)\n- _Wiki_ for project documentation\n- Deploy websites with _pages_\n\n## Further benefits of GitHub\n\n### Research compendia\n\nPotential to use Binder to so that people can run your code in the browser\n\n - For short analysis (<10 min) on small data (< 10MB)\n \n - [Zero to Binder](https://the-turing-way.netlify.app/communication/binder/zero-to-binder.html) tutorial [Julia, Python, R]\n \n### Software packages\n\n- Users can install Julia/Python/R packages from GitHub\n\n- Can deploy package websites using GitHub pages\n\n- Can benefit from GitHub Actions, e.g. automatically running tests\n\n## Your turn! Explore some GitHub repositories\n\n- [This course website and slides](https://github.com/Warwick-Stats-Resources/r-training)\n- [{palmerpenguins}](https://github.com/allisonhorst/palmerpenguins)\n- [R development guide](https://github.com/r-devel/rdevguide)\n\n## Your turn! Create a GitHub repository\n\n- Login or sign up for a free account at <https://www.github.com>.\n\n    - Recommend to use personal email\n    - Username recommendations:\n    \n        - Incorporate your actual name\n        - Reuse your username from other contexts.\n        - Use a name you can share in professional contexts.\n        - Use all lower case letters.\n- Click on `+` in the top right to create a new, public, repository called `github-intro`.\n\n    - Choose to initialize the repository with a README file\n    \n## Your turn! Edit on GitHub\n:::{.smaller75}\n- Click the pencil icon on the `README.md` file to edit.\n\n   - Update the title\n   - Add some example content using markdown syntax\n   - Use the \"Preview changes\" tab to check your edits\n   \n- Scroll down to the **Commit changes** section\n    \n    - Add a short description of your changes in the first dialog box, e.g. `add basic information to README`\n\n    - Click the green `Commit changes` button \n\n    - This will stage and commit the file in one go.\n        \n- View the commit history (look for clock icon with anti-clockwise arrow) and look at the diff for your commit.        \n\nSee [Basic writing and formatting syntax](https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax) for more on editing markdown.\n\n:::\n\n## Your turn! Continue experimenting\n\nFurther exercises to do while other people set up authentication.\n\n* Try uploading a picture from [Unsplash](https://unsplash.com/). Go to Add file > Upload files. Edit your README to add the image.\n\n* Go to Add file > Create new file. Type `subfolder/` in the \"Name your file box\" to create a subfolder. Now type `README.md` in the \"Name your file box\". Add some content to the README and commit - try some new markdown syntax, e.g. emoji or a table.\n\n* [Build a stunning README for your GitHub profile](https://towardsdatascience.com/build-a-stunning-readme-for-your-github-profile-9b80434fe5d7)\n\n# Configuring git and GitHub {background-color=\"#552D62\"}\n\n## Using git locally\n\nCheck if you already have git by running the following command in a terminal (e.g. Terminal tab on RStudio).\n\nOn MacOS/Linux (or Windows with Rtools)\n\n::: {.cell}\n\n```{.sh .cell-code}\nwhich git\n```\n:::\n\n\nOn Windows\n\n\n::: {.cell}\n\n```{.sh .cell-code}\nwhere git\n```\n:::\n\n\nMacOS: If asked to install the Xcode command line tools, say yes - this will install git.\n\n## Installing git\n\nWindows: \n\n - Use the installer from <https://git-scm.com/downloads>\n - Check RStudio can find the git executable\n \n     - Go to Tools > Global Options > Git/SVN to check\n     - Restart RStudio before trying to use git\n     \nLinux:\n\n::: {.cell}\n\n```{.sh .cell-code}\nsudo apt-get install git\n```\n:::\n\nor\n\n::: {.cell}\n\n```{.sh .cell-code}\nsudo yum install git\n```\n:::\n\n\n## Configure git (globally)\n\nSet the default name and email to associate with your git commits:\n\n```r\nlibrary(usethis)\nuse_git_config(\n  user.name = \"Ada Lovelace\",     # your full name\n  user.email = \"ada@example.com\"  # email associated with GitHub account\n  )\n```\n\nTo keep your email private:\n\n   - Go to <https://github.com/settings/emails>, select “Keep my email address private” and “Block command line pushes that expose my email” options\n   - Configure git to use the address provided of the form <ID+username@users.noreply.github.com>\n   \n## Authentication\n\nGitHub requires authentication with a Personal Access Token or SSH key.\n\n| SSH keys                | PAT                 |\n|-------------------------|---------------------|\n| More setup (on Windows) | **usethis** helpers |\n| Once per computer+host  | Renew every 30 days (recommended) |\n| Need for HPC            | Need for **usethis**/other R packages |\n\nRecommend: PAT now (easier), SSH later if needed\n\n## Main recommendations\n\nFrom {usethis} vignette [Managing Git(Hub) Credentials](https://usethis.r-lib.org/articles/git-credentials.html):\n\nOur main recommendations are:\n\n  - Adopt HTTPS as your Git transport protocol.\n  - Turn on two-factor authentication for your GitHub account.\n  - Use a personal access token (PAT) for all Git remote operations from the command line or from R.\n  - Allow tools to store and retrieve your credentials from the Git credential store. If you have previously set your GitHub PAT in .Renviron, stop doing that.\n\n*Highly recommend reading this entire vignette and following all guidance*\n\n## sitrep and vaccinate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(usethis) # make sure > v2.0.0\ngit_sitrep() # current situation report\ngit_vaccinate() # add files to global .gitignore (best practice)\n```\n:::\n\n\n## Get a personal access token (PAT)\n\nFirst, make sure you're signed into GitHub. Then run\n\n\n::: {.cell}\n\n```{.r .cell-code}\nusethis::create_github_token()\n```\n:::\n\n\n- Add Note describing use-case (e.g. personal-macbook-pro-2021, project-xyz)\n- Select expiration (recommend default 30 days)\n- Check scope\n- Click 'Generate Token'\n- **Important!** Copy token to clipboard, do not close window until stored!\n- You may want to store token in a secure vault, like 1Password\n\n## Put your PAT into the local Git credential store\n\nAssume token is on your clipboard\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngitcreds::gitcreds_set()\n```\n:::\n\n\n- If you don't have a PAT stored, will prompt you to enter: paste!\n- If you do, you will be given a choice to keep/replace/see the password\n  - choose as appropriate\n  - if replacing, paste!\n  \n## PAT maintenance\n\n- By default token will expire after 30 days.\n- Return to <https://github.com/settings/tokens> and click on its *Note*\n  - or else click on link in e-mail telling you token is about to expire!\n- Regenerate token\n- rerun `gitcreds::gitcreds_set()`\n\nA bit of a pain to do this every month, but only takes a couple of minutes.\n\n## Your turn!\n\nIf you need to, generate and store a PAT, as described over last few slides and in the [vignette](https://usethis.r-lib.org/articles/git-credentials.html).\n\nIf you already have a PAT set, read the vignette and follow through on other best pracice recommendations.\n\n## Create an RStudio project from a GitHub repo\n\nNow you can clone your GitHub repo locally.\n\n- Go to your repo homepage on GitHub. Click the green \"Code\" button, copy the HTTPS address (of the form `https://github.com/USERNAME/REPO.git`).\n\n- In RStudio, go to File > New Project… > Version Control > Git.\n\n  - Enter the repo URL you just copied. The project directory name will be filled automatically.\n  - Browse to a location you want the project directory to be created.\n  - Click `Create Project`.\n\n## Git tab\n\nA Git tab is added to the pane that is in the top right by default, usually with Environment, History, and Connections tabs.\n\nThe initial view is equivalent to the output of the terminal command `git status`. \n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\nWe can *stage* changes to commit\n\n![](../images/stage_changes.png)\nUnderlying command:  \n`git add <file/folder>`.\n:::\n\n::: {.column width=\"50%\"}\nThen *commit* a set of changes\n\n![](../images/commit_changes.png)\nUnderlying command:  \n`git commit -m \"commit message\"`\n:::\n\n::::\n\n## .gitignore\n\nAt this stage you should see two untracked files in your Git Pane that were created when setting up the project: an `.Rproj` file and a `.gitignore` file.\n\nThe `.gitignore` file specifies files that git should ignore - they won't appear in the git pane even as untracked files. \n\nExamples of how to specify files in `.gitignore`:\n\n- Single file: `.Rhistory`\n- File pattern: `*.log` (all files with `.log` extension)\n- Directory (and files in it): `/dirname/`\n\nThe `.gitignore` file must at least be staged to have an effect.\n\n## First commit from RStudio\n\n- Stage and commit the `.Rproj` file and `.gitignore` file, with the message \"setup RStudio project\".\n\n- Click on the clock icon in the Git pane to view the history of previous commits. \n\n- Close the \"Review Changes\" window. Now click the green up arrow to push your changes to GitHub.\n\n- Go to the repo on GitHub and verify your changes have been pushed.\n\n## Pulling changes from GitHub\n\n- Edit the README once more on GitHub in a new commit.\n\n- Back in RStudio, on the Git tab, click the blue down arrow to *pull* the changes from GitHub\n\n- The changes to README should now appear in your local copy\n\n## Avoid conflicts\n\nIf you work on both the local and GitHub copy, it's possible to get out of sync and end up with conflicting versions of the same file.\n\nIt *is* possible to fix this, but it can be tricky/confusing. It's best to avoid problem in first place!\n\nRecommended practice:\n\n- Always commit and push changes at the end of an RStudio session\n- Always pull changes at the beginning of an RStudio session\n\n## Set `.Rprofile` to check git status\n\nThis is a neat trick (credit: Lisa De Bruine)\n\nOpen your `.Rprofile`\n```r\nusethis::edit_r_profile()\n```\nand add the following (credit: Lisa De Bruine)\n```r\ncat(cli::col_blue(system(\"git status -u no\", TRUE)))\n```\nThis will run `git status` from the command line when you start R, giving a (blue coloured!) message e.g.\n```\nOn branch main Your branch is behind 'origin/main' by 1 commit,\nand can be fast-forwarded.   (use \"git pull\" to update your  \nlocal branch)  nothing to commit, working tree clean\n```\n\nIf your main branch is behind the main branch on _origin_ (GitHub), you should pull changes before making new edits.\n\n## Advanced: Amend commit (before pushing)\n\nSometimes we don't stage everything we intended to include in a commit, e.g. we committed a file before saving the latest changes.\n\nIf we haven't yet pushed the commit to GitHub, simply stage the extra commits and check the \"Amend previous commit\" box under the commit message. \n\nThe original commit message will be shown - you can edit this to change the message for the amended commit (useful if you forgot to reference a GitHub issue number)\n\n## Advanced: Undo last commit (before pushing)\n\nAlternatively, you can undo a commit before pushing.\n\nTo undo the commit, keeping files as they are\n\n::: {.cell}\n\n```{.sh .cell-code}\ngit reset HEAD~1\n```\n:::\n\n(change the 1 to a higher number to go back more than 1 commit).\n\nTo undo the commit *and all the changes in that commit*\n\n::: {.cell}\n\n```{.sh .cell-code}\ngit reset --hard HEAD~1\n```\n:::\n\nThis goes back to the version at the last commit. \n\n## Advanced: Undo last commit (after pushing)\n\nIt is best practice to create a new commit that undoes the changes. Run\n\n::: {.cell}\n\n```{.sh .cell-code}\ngit revert HEAD\n```\n:::\n\nThis edits the files to undo the changes in your last commit. You should then commit these edits, with a relevant message.\n\nIt is possible to use `git reset --hard` to undo a commit and then `git push origin main --force` to force this change onto GitHub. Sometimes repository maintainers do not allow this as it rewrites the history, which can cause problems for people that have cloned or forked your repo.\n\n## General workflow\n\n* Commit regularly, once you've got a small complete change, e.g. a working draft of a function, a bug fix, a draft of a README.\n\n  - It is easier to review/revert changes if they relate to a single file or common issue\n \n - Ideally, make a commit everytime you make a substantial, coherent set of changes.\n \n - At least make a commit every time you take a break, especially when leaving at the end of your working session\n\n* Push often enough that GitHub is a useful backup\n \n\n## Adding an existing project to GitHub\n\nThe simplest approach is to create a GitHub repo with just a README as before, create the corresponding RStudio project, copy your files into the new directory, stage and commit them.\n\nIf you are already using git and want to move the project to GitHub, see [Adding a local repository to GitHub using git](https://docs.github.com/en/get-started/importing-your-projects-to-github/importing-source-code-to-github/adding-locally-hosted-code-to-github#adding-a-local-repository-to-github-using-git). Once the project is on GitHub you can clone it into an RStudio project.\n\n## Some other tools\n\n- [gert](https://docs.ropensci.org/gert/) R package has functions for interacting with git\n\n- It can be worth using dedicated software for interacting with git/GitHub\n\n  - [GitHub desktop](https://desktop.github.com)\n  \n  - [GitKraken](https://www.gitkraken.com)\n\n## Summary\n\n- Working openly encourages good practices\n\n- Your code/software is an asset!\n\n- We can make steps to improve our own practice\n\n- git and GitHub are invaluable resources for version control and collaboration\n\n# {#github-friends data-menu-title=\"GitHub for collaboration\" background-image=\"../images/github_friends.png\" background-size=\"contain\"}\n\n## Learning more\n\n- Happy Git and GitHub for the useR by Jenny Bryan\n\n  <http://happygitwithr.com>\n\n- GitHub for supporting, reusing, contributing and failing safely by Allison Horst and Julie Lowndes\n  \n  <https://www.openscapes.org/blog/2022/05/27/github-illustrated-series/>\n\n- Version control: A practical introduction to Git and GitHub\n\n  <https://www.jvcasillas.com/github_workshop/index.html#1>\n\n# End Matter {background-color=\"#552D62\"}\n\n## License\n\nLicensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License ([CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/){target=\"_blank\"}).\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}